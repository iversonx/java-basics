默认情况下，是以同步方式发送消息，其默认超时时间为3s。

当调用`DefaultMQProducer#send(msg)`发送消息时，最终是由`DefaultMQProducerImpl.sendDefaultImpl(msg)`来处理消息发送逻辑。

#### 1、验证消息

`DefaultMQProducerImpl.sendDefaultImpl(msg)`方法首先会对消息进行校验

- Topic名称和消息体不能为空

- Topic名称不能有正则表达式以外的特殊字符。正则表达式`"^[%|a-zA-Z0-9_-]+$"`

- Topic名称长度不能超过255

- Topic名称不能为默认Topic名称`TBW102`

- 消息长度不能超过允许发送消息的最大长度，默认为4M。

> 消息的最大长度如何配置?

#### 2、查找路由

消息验证通过之后，就去获取Topic的路由信息，从而知道消息要发送到哪个Broker节点。

`DefaultMQProducerImpl#tryToFindTopicPublishInfo`负责查找Topic的路由信息。

- 从生产者缓存`DefaultMQProducerImpl#topicPublishInfoTable`中获取Topic的路由信息，如果有，就直接返回该路由信息

- 如果缓存中没有，就从NameServer中查询；

- 如果NameServer中没有找到Topic的路由信息，就再使用默认Topic去查询；如果还没有找到，就抛出无法找到Topic路由信息异常。

- 如果NameServer中查询到了Topic的路由信息，就与本地缓存中的路由信息进行对比，判断路由信息是否发生改变

- 如果路由信息发生了改变，就更新`MQClientInstance#brokerAddrTable`缓存表

#### 3、选择消息队列

#### 4、消息发送
